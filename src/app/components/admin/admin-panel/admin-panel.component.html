<div fxLayout="column">
  <div class="button-panel" fxLayout="row" fxLayoutGap="15px" fxLayoutAlign="start center">
    <button mat-raised-button color="primary" matTooltip="Close" (click)="close()">Close</button>
  </div>

  <div class="content" fxLayout="row">
    <div fxLayout="column" fxFlex="40%">
      <mat-card *ngFor="let user of users" (click)="select(user)">
        <mat-card-header>
          <div mat-card-avatar class="user-avatar-image" [style.backgroud-image]="user.imageUrl"></div>
          <mat-card-title>{{user.username}}</mat-card-title>
          <mat-card-subtitle
            *ngIf="user.firstName || user.lastName">{{user.firstName}} {{user.lastName}}</mat-card-subtitle>
          <mat-card-subtitle>{{user.email}}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-chip-list>
            <mat-chip *ngIf="user.userRoleId === superuserRole.id" [style.background-color]="'#ffcc00'" selected>{{superuserRole.name}}</mat-chip>
            <mat-chip *ngIf="user.userRoleId === adminRole.id" [style.background-color]="'#ff0000'" selected>{{adminRole.name}}</mat-chip>
            <mat-chip *ngIf="user.userRoleId === moderatorRole.id" [style.background-color]="'#ff66ff'" selected>{{moderatorRole.name}}</mat-chip>
            <mat-chip *ngIf="user.userRoleId === userRole.id" [style.background-color]="'#00cc44'" selected>{{userRole.name}}</mat-chip>
            <mat-chip *ngIf="!user.activated" color="warn" selected>Not activated</mat-chip>
          </mat-chip-list>
        </mat-card-content>
      </mat-card>
    </div>

    <div fxFlex="40%">
      <mat-card *ngIf="selectedUser" fxLayout="column" fxLayoutAlign="start stretch">
        <div fxLayout="row">
          <div fxLayout="column" fxFlex="50%">
            <app-warning-message-box *ngIf="isError" [message]="errorMessage"></app-warning-message-box>
            <mat-card-header fxFlex="50%" fxLayout="row">
              <div fxFlex="50%">
                <mat-card-title>
                  User
                </mat-card-title>
                <mat-card-subtitle>
                  {{selectedUser.username}}
                </mat-card-subtitle>
              </div>
              <mat-chip *ngIf="!selectedUser.activated" color="warn">Not activated</mat-chip>
            </mat-card-header>
          </div>
          <div fxLayoutAlign="start end" fxFlex="50%">
            <button *ngIf="selectedUser" mat-mini-fab color="accent" (click)="deselect()">
              <mat-icon>cancel</mat-icon>
            </button>
          </div>
        </div>

        <mat-card-content fxLayout="column">
          <mat-form-field appearance="fill" *ngIf="selectedUser.userRoleId !== superuserRole.id">
            <mat-label>User's role</mat-label>
            <mat-select [formControl]="roleControl" required [(value)]="selectedUser.userRoleId"
                        (valueChange)="updateUser()">
              <mat-option *ngFor="let role of availableRoles" [value]="role.id">
                {{role.name}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="roleControl.hasError('required')">Please choose a role</mat-error>
          </mat-form-field>

        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

